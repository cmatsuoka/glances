name: glances
adopt-info: glances
summary: Glances an Eye on your system. A top/htop alternative.
description: |
  Glances is a cross-platform monitoring tool which aims to present
  a maximum of information in a minimum of space through a curses or
  Web based interface. It can adapt dynamically the displayed information
  depending on the user interface size.

base: core20
grade: stable
confinement: strict

apps:
  glances:
    command: bin/glances-launch $SNAP/bin/glances
    plugs:
      - network
      - system-observe
      - mount-observe
      - hardware-observe
      - log-observe
      - network-observe
      - physical-memory-observe
      - upower-observe
      - home
      - network-bind
    environment:
      LANG: C.UTF-8
      LC_ALL: C.UTF-8

plugs:
  home-glances-config:
    interface: personal-files
    read:
      - $HOME/.config/glances/glances.conf
  etc-glances-config:
    interface: system-files
    read:
      - /etc/glances/glances.conf

parts:
  glances:
    after:
    - selective-checkout
    plugin: python
    source: .
    python-packages:
      - bottle
      - influxdb-client==1.39
    # FIXME: Theoretically this also replaces `summary` and `description`
    #        keys, however due to the following bug we still need to keep
    #        them until it is fixed.
    #        https://bugs.launchpad.net/snapcraft/+bug/1813364
    parse-info: [setup.py]
    stage-packages:
      - file
    override-pull: |
      snapcraftctl pull
      "$SNAPCRAFT_STAGE"/scriptlets/selective-checkout

  fastapi:
    plugin: python
    source: https://github.com/tiangolo/fastapi.git
    source-tag: '0.104.1'
    source-depth: 1
    override-build: |
      mkdir -p $SNAPCRAFT_PART_BUILD/dist
      cp -r $SNAPCRAFT_PART_BUILD/dist $SNAPCRAFT_PART_INSTALL/fastapi-dist
    organize:
      fastapi-dist: fastapi/dist

  uvicorn:
    plugin: python
    source: https://github.com/encode/uvicorn.git
    source-tag: '0.24.0.post1'
    source-depth: 1
    override-build: |
      mkdir -p $SNAPCRAFT_PART_BUILD/dist
      cp -r $SNAPCRAFT_PART_BUILD/dist $SNAPCRAFT_PART_INSTALL/uvicorn-dist
    organize:
      uvicorn-dist: uvicorn/dist

  orjson:
    plugin: python
    source: https://github.com/ijl/orjson.git
    source-tag: '3.9.10'
    source-depth: 1
    override-build: |
      mkdir -p $SNAPCRAFT_PART_BUILD/dist
      cp -r $SNAPCRAFT_PART_BUILD/dist $SNAPCRAFT_PART_INSTALL/orjson-dist
    organize:
      orjson-dist: orjson/dist

  jinja2:
    plugin: python
    source: https://github.com/pallets/jinja.git
    source-tag: '3.1.2'
    source-depth: 1
    override-build: |
      mkdir -p $SNAPCRAFT_PART_BUILD/dist
      cp -r $SNAPCRAFT_PART_BUILD/dist $SNAPCRAFT_PART_INSTALL/jinja2-dist
    organize:
      jinja2-dist: jinja2/dist

  docker:
    plugin: python
    source: https://github.com/docker/docker-py.git
    source-tag: '3.7.3'
    source-depth: 1
    override-build: |
      mkdir -p $SNAPCRAFT_PART_BUILD/dist
      cp -r $SNAPCRAFT_PART_BUILD/dist $SNAPCRAFT_PART_INSTALL/docker-dist
    organize:
      docker-dist: docker/dist

  launchers:
    source: snap/local/launchers
    plugin: dump
    organize:
      '*': bin/

  selective-checkout:
    plugin: nil
    build-packages:
    - git
    stage-snaps:
    - selective-checkout
    prime:
    - -*
